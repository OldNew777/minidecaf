### Step5实验报告

2018013443 陈新 计82

#### 实验内容

step5要实现变量的声明和使用，因此我维护了一个全局的变量表，不分作用域并且没有释放的环节。

变量依次储存在fp-4,fp-8,...位置，并且是遇到了变量声明的语句才会分配空间。由于前几次实验中表达式在计算完之后都会自动释放掉栈空间，因此不会造成位置计算出错。

给变量赋值的时候见从变量表中取出变量的栈帧位置，再进行存储

语义检查十分简单，由于现在是单main函数，因此只需要在添加变量时检查变量表是否已经存在该变量即可实现不能重复声明；调用变量时检查变量表，不存在变量则报错，即实现了不能使用未声明的变量

---------------------

#### 思考题

1. 描述程序运行过程中函数栈帧的构成，分成哪几个部分？每个部分所用空间最少是多少？

   如果默认是32位指令集，函数栈帧分3个部分，从高地址到低地址分别是：

   函数返回地址与父函数栈底指针fp：8字节

   当前函数作用域内局部变量：最少占用0，假如函数内没有局部变量

   计算表达式的运算栈：最少占用0，当不在计算表达式过程中时为空

   

2. 如果 MiniDecaf 也允许多次定义同名变量，并规定新的定义会覆盖之前的同名定义，请问在你的实现中，需要对定义变量和查找变量的逻辑做怎样的修改？

   因为现在声明函数的逻辑是先计算初始值，再分配栈空间并将这个值写入。因此在声明变量时，只需要检查变量表是否已有该变量，如果已经有了，不报错而返回存好的offset即可实现变量的覆盖

